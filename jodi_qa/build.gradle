apply plugin: 'groovy'

liquibase {
    activities {
        main {
            changeLogFile 'src/main/resources/main.xml'
            url 'jdbc:oracle:thin:@jodi:1521/SAMPLE20'
            username ''
            password ''
        }
//        security {
//            changeLogFile 'src/main/db/security.xml'
//            url project.ext.securityUrl
//            username project.ext.securityUsername
//            password project.ext.securityPassword
//        }
//        diffMain {
//            changeLogFile 'src/main/db/main.xml'
//            url project.ext.mainUrl
//            username project.ext.mainUsername
//            password project.ext.mainPassword
//            difftypes 'data'
//        }
    }
    runList = 'main'
}

test {
    systemProperty 'ODI_REPO_PWD', System.getProperty("ODI_REPO_PWD")
    systemProperty 'ODI_USER_PWD', System.getProperty("ODI_USER_PWD")
    systemProperty 'ORCL_SYS_USER_PWD', System.getProperty("ORCL_SYS_USER_PWD")
    systemProperty 'ODI_DAPWD', System.getProperty("ODI_DAPWD")
    // memory settings moved to ../gradle.properties
    maxHeapSize = "2048m"
    // each test is run by parallel agent; rational is that we have large 
    // test cases that require a long execution time with lot's of I/O
    forkEvery = 1
}

jar {
    manifest {
        attributes 'Implementation-Title': 'Jodi QA', 'Implementation-Version': archiveVersion
    }
    include("$buildDir/reports/**")
}

sourceSets {
    test {
        compileClasspath += files(new File('../jodi_odi12/src/test/java/'))
        runtimeClasspath += files(new File('../jodi_odi12/src/test/java/'))
    }
}

dependencies {
    // include ODI 12.2 (in implementation context for Eclipse or provided for build)
    implementation project(':jodi_odi12')
//    implementation fileTree(dir: 'lib', include: '*.jar')
    implementation project(':jodi_odi12')
    implementation 'org.codehaus.groovy:groovy-all:2.4.14'
    implementation project(path: ':jodi_core', configuration: 'xmlExtensions')

    implementation  'org.dbunit:dbunit:2.5.1'
    implementation group: 'ch.qos.logback', name: 'logback-classic', version: '1.1.3'

    // ojdbc10
    compile fileTree(include: ['*.jar'], dir: 'lib')


    // for test
    compile project(path: ':jodi_core', configuration: 'xmlExtensions')
    testImplementation group: 'org.dbunit', name: 'dbunit', version: '2.5.1'
    testImplementation "xmlunit:xmlunit:1.6"
    compile project(path: ':jodi_base', configuration: 'testArtifacts')
}

// not needed and remains empty
def fixWindowsStartScript(writer, lines) {}

def fixUnixStartScript(writer, lines) {}
